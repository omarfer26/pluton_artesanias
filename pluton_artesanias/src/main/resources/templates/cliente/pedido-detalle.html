<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Detalle del Pedido</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
</head>
<body>

<h2>Pedido #<span th:text="${pedido.id}"></span></h2>

<p><strong>Cliente:</strong> <span th:text="${pedido.clienteNombre}"></span></p>
<p><strong>Estado:</strong> <span th:text="${pedido.estado}"></span></p>
<p><strong>Total:</strong> $<span th:text="${pedido.total}"></span></p>
<p><strong>Fecha de entrega:</strong> <span th:text="${#temporals.format(pedido.fechaEntrega,'yyyy-MM-dd HH:mm')}"></span></p>
<p><strong>Notas:</strong> 
    <span th:text="${pedido.notas != null ? pedido.notas : 'Ninguna'}"></span>
</p>

<hr>

<h3>Productos del Pedido</h3>
<table border="1">
    <tr>
        <th>Producto</th>
        <th>Cantidad</th>
        <th>Subtotal</th>
    </tr>

    <tr th:each="d : ${pedido.detalles}">
        <td th:text="${d.producto.nombre}"></td>
        <td th:text="${d.cantidad}"></td>
        <td th:text="${d.subtotal}"></td>
    </tr>
</table>

<hr>

<!-- Solo mostrar cancelar si NO estÃ¡ cancelado ni entregado -->
<div th:if="${pedido.estado != 'DELIVERED' and pedido.estado != 'CANCELLED'}">
    <form th:action="@{'/cliente/dashboard/pedido/' + ${pedido.id} + '/cancelar'}" method="post">
        <button type="submit" style="background:red;color:white;">Cancelar Pedido</button>
    </form>
</div>

<br>
<button onclick="window.history.back()">Regresar</button>

</body>
</html>
